<%- | String $config_file_version
| -%>
##################################################################
###################################################################
####
####        This file is managed by Puppet
####
####################################################################
####################################################################

# veeam.ini, <%= $config_file_version %>
# This is the veeamservice system-wide configuration file.
# The strategy used for options in the default veeam.ini shipped with
# Veeam Agent for Linux is to specify options with their default value where
# possible, but leave them commented. Uncommented options override the
# default value.

[backup]
# Backup cluster alignment logarithm
# clusterAlign= 3
<% if $veeamagent::cluster_align {-%>
clusterAlign= <%= $veeamagent::cluster_align %>
<% } -%>

# Ignore inactive LVM logical volumes during backup
# ignoreInactiveLvm= false
<% if $veeamagent::inactivelvm_ignore {-%>
ignoreInactiveLvm= <%= $veeamagent::inactivelvm_ignore %>
<% } -%>

# IO rate limit, from 0.01 to 1.0
# ioRateLimit= 0.9
<% if $veeamagent::iorate_limit {-%>
ioRateLimit= <%= $veeamagent::iorate_limit %>
<% } -%>

# CPU priority for veeamagents, from 0 to 19
# priority= 10
<% if $veeamagent::cpu_priority {-%>
priority= <%= $veeamagent::cpu_priority %>
<% } -%>

[bitlooker]
# Enable BitLooker
# enabled= true
<% if $veeamagent::bitlooker_enabled {-%>
enabled= <%= $veeamagent::bitlooker_enabled %>
<% } -%>
<% if $veeamagent::agent_version == 2 {-%>

# Exclude the specified devices from BitLooker processing (e.g. /dev/sda1, /dev/sdb3)
# exclude=
<% if $veeamagent::bitlooker_exclude {-%>
exclude= <%= $veeamagent::bitlooker_exclude.join(', ') %>
<% } -%>

# BitLooker timeout per device, ms
# timeout= 900000
<% if $veeamagent::bitlooker_timeout {-%>
timeout= <%= $veeamagent::bitlooker_timeout %>
<% } -%>

<% } -%>
[db]
# Veeam database path
# path= /var/lib/veeam/veeam_db.sqlite
<% if $veeamagent::db_path {-%>
path= <%= $veeamagent::db_path %>
<% } -%>

# Veeam database scheme path
# schemePath= /usr/share/veeam/lpb_scheme.sql
<% if $veeamagent::db_schemepath {-%>
schemePath= <%= $veeamagent::db_schemepath %>
<% } -%>

# Veeam database upgrade scheme path
# schemeUpgradePath= /usr/share/veeam/lpb_upgrade_scheme.sql
<% if $veeamagent::db_schemeupgradepath {-%>
schemeUpgradePath= <%= $veeamagent::db_schemeupgradepath %>
<% } -%>


[general]
<% if $veeamagent::agent_version == 2 {-%>
# Root folder path for mount file systems of backup disks
# backupDisksFsMountFolder= /mnt/backup
<% if $veeamagent::backup_disks_fs_mount {-%>
backupDisksFsMountFolder= <%= $veeamagent::backup_disks_fs_mount %>
<% } -%>

# Root folder path for mount backup disks
# backupDisksMountFolder= /mnt/backup
<% if $veeamagent::backup_disks_mount {-%>
backupDisksFsMountFolder= <%= $veeamagent::backup_disks_mount %>
<% } -%>

# Force FUSE mount on kernels 4.0.0-4.1.33 (for file level restore)
# ignoreFuseBug= false
<% if $veeamagent::ignore_fuse_bug {-%>
ignoreFuseBug= <%= $veeamagent::ignore_fuse_bug %>
<% } -%>

<% } -%>
# Logs path
# logsFolder= /var/log/veeam
<% if $veeamagent::log_dir {-%>
logsFolder= <%= $veeamagent::log_dir %>
<% } -%>
<% if $veeamagent::agent_version == 2 {-%>

# Logs rotation period, days
# logsRotateDays= 14
<% if $veeamagent::log_rotate_days {-%>
logsRotateDays= <%= $veeamagent::log_rotate_days %>
<% } -%>

# Temp directory path
# temporaryDirectory= /tmp/veeam
<% if $veeamagent::temp_dir {-%>
temporaryDirectory= <%= $veeamagent::temp_dir %>
<% } -%>

<% } -%>


[job]
# New job default retries count
# retriesCount= 3
<% if $veeamagent::job_retries {-%>
retriesCount= <%= $veeamagent::job_retries %>
<% } -%>
<% if $veeamagent::agent_version == 2 {-%>

# Job retry delay interval (seconds)
# retriesInterval= 600
<% if $veeamagent::job_retry_interval {-%>
retriesInterval= <%= $veeamagent::job_retry_interval %>
<% } -%>
<% } -%>

# Retry all errors, set to 'false' to enable retries only for 'snapshot overflow'
# retryAllErrors= true
<% if $veeamagent::job_retryallerrors {-%>
retryAllErrors= <%= $veeamagent::job_retryallerrors %>
<% } -%>

<% if $veeamagent::agent_version == 2 {-%>
[reconnects]
# Time to wait before each reconnect attempt, ms
# attemptInterval= 5000
<% if $veeamagent::reconnect_attempt_interval {-%>
attemptInterval= <%= $veeamagent::reconnect_attempt_interval %>
<% } -%>

# Enable reconnect
# enabled= true
<% if $veeamagent::reconnect_enabled {-%>
enabled= <%= $veeamagent::reconnect_enabled %>
<% } -%>

# Reconnect attempts timeout, ms
# overallTimeout= 300000
<% if $veeamagent::reconnect_overall_timeout {-%>
overallTimeout= <%= $veeamagent::reconnect_overall_timeout %>
<% } -%>

<% } -%>
[scripts]
# Ignore freeze and thaw scripts result
# ignoreFreezeThawFailures= false
<% if $veeamagent::freezethawfailure_ignore {-%>
ignoreFreezeThawFailures= <%= $veeamagent::freezethawfailure_ignore %>
<% } -%>

# Timeout for freeze and thaw scripts
# timeoutFreezeThaw= 600
<% if $veeamagent::freezethaw_timeout {-%>
timeoutFreezeThaw= <%= $veeamagent::freezethaw_timeout %>
<% } -%>

# Timeout for pre- and post-backup scripts
# timeoutPrePost= 600
<% if $veeamagent::prepost_timeout {-%>
timeoutPrePost= <%= $veeamagent::prepost_timeout %>
<% } -%>


[service]
# Service socket
<% if $veeamagent::agent_version == 1 {-%>
# socket_path= /tmp/veeam/socket/veeam.sock
<% } elsif $veeamagent::agent_version == 2 {-%>
# socket_path= /var/tmp/veeam/socket/veeam.sock
<% } -%>
<% if $veeamagent::socket_path {-%>
socket_path= <%= $veeamagent::socket_path %>
<% } -%>


[snapshot]
<% if $veeamagent::agent_version == 2 {-%>
# Free percent of storage. Used for calculate optimal snapshot data size and determinate snapshot data location, not for stretch snapshot
freePercent= <%= $veeamagent::snapshot_free_percent %>

<% } -%>
# Percent of free space on block device can be used for snapshot data allocating
# limitFreePercent= 50
<% if $veeamagent::freepercent_limit {-%>
limitFreePercent= <%= $veeamagent::freepercent_limit %>
<% } -%>

# Location folder for snapshot data, only for 'stretch' and 'common' snapshot
# location=
<% if $veeamagent::snapshot_location {-%>
location= <%= $veeamagent::snapshot_location %>
<% } -%>

# Maximum possible snapshot data size, not for stretch snapshot
# maxSize= 21474836480
<% if $veeamagent::snapshot_maxsize {-%>
maxSize= <%= $veeamagent::snapshot_maxsize %>
<% } -%>

# Minimal possible snapshot data size, not for stretch snapshot
# minSize= 536870912
<% if $veeamagent::snapshot_minsize {-%>
minSize= <%= $veeamagent::snapshot_minsize %>
<% } -%>

# Snapshot data type, can be 'stretch' (default) or 'common'
# type=
<% if $veeamagent::snapshot_type {-%>
type= <%= $veeamagent::snapshot_type %>
<% } -%>

<% if $veeamagent::agent_version == 2 {-%>
# Used percent of storage. Used for calculate optimal snapshot data size and determinate snapshot data location, not for stretch snapshot
<% if $veeamagent::snapshot_used_percent {-%>
usedPercent= <%= $veeamagent::snapshot_used_percent %>
<% } -%>

<% } -%>
[stretchsnapshot]
# Stretch snapshot data portion
# portionSize= 1073741824
<% if $veeamagent::stretchsnapshot_portionsize {-%>
portionSize= <%= $veeamagent::stretchsnapshot_portionsize %>
<% } -%>

<% if $veeamagent::agent_version == 2 {-%>
# Free percent of storage. Used for determinate snapshot data location. Only for stretch snapshot
<% if $veeamagent::stretchsnapshot_storage_free_percent {-%>
storageFreePercent= <%= $veeamagent::stretchsnapshot_storage_free_percent %>
<% } -%>

<% } -%>
[veeamsnap]
# Kernel log logging level. 7 - list all messages as an error, 4 or 0 - all messages as a warning, 2 - all message as a trace (use only if veeam works perfectly on your system)
# debuglogging= 0
<% if $veeamagent::log_debuglevel {-%>
debuglogging= <%= $veeamagent::log_debuglevel %>
<% } -%>
